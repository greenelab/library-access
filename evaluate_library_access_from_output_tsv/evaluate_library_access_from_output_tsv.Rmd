---
title: "Evaluate Library Access from the Output TSV"
author: "Jacob Levernier"
date: "2017"
output: pdf_document
---

```{r settings, include = FALSE}
lzma_compressed_library_access_tsv_location <- file.path(
  'data', 'library_coverage_xml_and_fulltext_indicators.tsv.xz'
)

original_dataset_with_oa_color_column_location <- paste0(
  'https://github.com/greenelab/scihub/raw/',
  '4172526ac7433357b31790578ad6f59948b6db26/data/',
  'state-of-oa-dois.tsv.xz'
)

repository_root_directory <- '..'  # This sets the Working Directory that knitr uses when knitting this document back to the top directory of this repository.
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(include = FALSE)
knitr::opts_chunk$set(results = "asis")
knitr::opts_chunk$set(cache = TRUE)
knitr::opts_knit$set(root.dir = repository_root_directory)
```

```{r read and merge datasets}
source(file.path(
  'evaluate_library_access_from_output_tsv',
  'read_and_merge_library_access_datasets.R'
))

# The function below will return a merged dataset, but will *also* add the following datasets to our global environment:
# original_dataset_with_oa_color_column
# lzma_compressed_library_access_tsv

merged_datasets <- read_and_merge_library_access_datasets(
  lzma_compressed_library_access_tsv_location,
  original_dataset_with_oa_color_column_location
)
```

## Summary of the downloaded dataset

```{r analyze the merged dataset}
merged_datasets_without_doi_column <- merged_datasets[
  ,  # Use all rows
  c("oadoi_color", "full_text_indicator")
]

frequency_table_by_oa_color <- table(merged_datasets_without_doi_column)
# View(frequency_table_by_oa_color)

proportion_table_by_oa_color <- round(
  prop.table(
    frequency_table_by_oa_color,
    margin = 1)*100,
  digits = 2
)

frequency_and_proportion_table <- data.frame(
  "oa_doi_color" = rownames(proportion_table_by_oa_color),
  "no_access_percent" = proportion_table_by_oa_color[,1],
  "yes_access_percent" = proportion_table_by_oa_color[,2],
  "yes_access_rate" = frequency_table_by_oa_color[, 2],
  "oa_color_total" = frequency_table_by_oa_color[, 1] + frequency_table_by_oa_color[, 2]
)
rownames(frequency_and_proportion_table) <- NULL
# View(frequency_and_proportion_table)
```

We queried `r nrow(merged_datasets)` DOIs of the the `r nrow(original_dataset_with_oa_color_column)` listed in the original State of OA dataset. Queried DOIs included the following OA "colors:" `r paste(unique(merged_datasets$oadoi_color), collapse = ", ")`.

The proportions of access, alongside the rate of access, are presented below:

`r knitr::kable(frequency_and_proportion_table, format = "markdown")`
